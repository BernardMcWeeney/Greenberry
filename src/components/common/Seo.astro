---
import { SEO } from "astro-seo";
import { SITE, COMPANY, SOCIAL_LINKS } from "../../data/config";

export interface Props {
  title?: string;
  description?: string;
  image?: string;
  type?: string;
}

// Get defaults from your existing config
const {
  title = SITE.title,
  description = SITE.description,
  image = SITE.ogImage,
  type = "website"
} = Astro.props;

// Get current URL
const canonical = new URL(Astro.url.pathname, Astro.site).toString();

// Simple schema detection based on URL
const path = Astro.url.pathname.replace(/^\/|\/$/g, '') || 'index';

// Basic schema type detection
let schemaType = "WebPage";
if (path === 'index') schemaType = "WebSite";
if (path === 'about') schemaType = "AboutPage";
if (path === 'contact') schemaType = "ContactPage";
if (path === 'services' || path.startsWith('services/')) schemaType = "Service";

// Build schema data manually
const baseSchema = {
  "@context": "https://schema.org",
  "@type": schemaType,
  "name": title,
  "description": description,
  "url": canonical,
};

// Add organization data for homepage
let schemaData = baseSchema;
if (path === 'index') {
  schemaData = [
    baseSchema,
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": COMPANY.name,
      "url": SITE.url,
      "logo": SITE.ogImage,
      "address": {
        "@type": "PostalAddress",
        "addressLocality": COMPANY.address.split(',')[0].trim(),
        "addressCountry": "IE"
      },
      "sameAs": [
        SOCIAL_LINKS.twitter,
        SOCIAL_LINKS.facebook,
        SOCIAL_LINKS.instagram,
        SOCIAL_LINKS.linkedin
      ]
    }
  ];
}

// Convert schema to JSON
const schemaJson = JSON.stringify(schemaData);
---

<!-- SEO Meta Tags via astro-seo -->
<SEO
  title={title}
  description={description}
  canonical={canonical}
  openGraph={{
    basic: {
      title,
      type,
      image,
      url: canonical,
    },
    optional: {
      siteName: SITE.name,
      description,
    }
  }}
  twitter={{
    creator: "@greenberry",
    site: "@greenberry",
    card: "summary_large_image",
  }}
/>

<!-- Schema.org structured data -->
<script type="application/ld+json" set:html={schemaJson} />