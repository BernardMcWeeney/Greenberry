---
import testimonials from '../../data/testimonial';

export interface Props {
  title?: string;
  testimonialId: string | number;
  characterLimit?: number;
}

const {
  title = 'What Our Clients Say',
  testimonialId,
  characterLimit = 220
} = Astro.props;

const t = testimonials.find(x => String(x.id) === String(testimonialId));
---

{t && (
  <div class="rounded-2xl bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 shadow-sm p-6">
    <div class="flex items-center justify-between mb-4">
      <h3 class="text-xl font-bold text-neutral-900 dark:text-white">{title}</h3>
    </div>

    <div class="flex text-accent-orange-400 mb-3">
      {Array.from({ length: 5 }).map(() => (
        <i class="fa-solid fa-star mr-0.5" aria-hidden="true"></i>
      ))}
      {t.verified && (
        <span class="text-neutral-400 dark:text-neutral-500 text-xs ml-2 font-medium">Verified Client</span>
      )}
    </div>

    <p class="text-neutral-700 dark:text-neutral-300 italic leading-relaxed mb-5">
      "{t.quote.length > characterLimit ? t.quote.slice(0, characterLimit) + 'â€¦' : t.quote}"
    </p>

    <div class="mt-auto pt-4 border-t border-neutral-200 dark:border-neutral-700 flex items-start">
      <div class="w-10 h-10 rounded-full overflow-hidden mr-3 bg-neutral-100 dark:bg-neutral-700 flex-shrink-0">
        {t.avatar ? (
          <img
            src={t.avatar}
            alt={`Photo of ${t.author}`}
            class="w-full h-full object-cover"
            loading="lazy"
            decoding="async"
            onerror="this.style.display='none'; this.parentNode.innerHTML='<div class=&quot;w-full h-full flex items-center justify-center bg-neutral-100 dark:bg-neutral-700 text-neutral-500&quot;><i class=&quot;fa-solid fa-user&quot; aria-hidden=&quot;true&quot;></i></div>';"
          />
        ) : (
          <div class="w-full h-full flex items-center justify-center bg-neutral-100 dark:bg-neutral-700 text-neutral-500">
            <i class="fa-solid fa-user" aria-hidden="true"></i>
          </div>
        )}
      </div>
      <div class="min-w-0">
        <div class="text-sm font-semibold text-neutral-900 dark:text-white">{t.author}</div>
        {t.position && <div class="text-xs text-neutral-500 dark:text-neutral-400">{t.position}</div>}
        {t.company && <div class="text-xs text-greenberry-600 dark:text-greenberry-500 font-medium">{t.company}</div>}
      </div>
    </div>
  </div>
)}
